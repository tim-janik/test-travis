# This Source Code Form is licensed MPLv2: http://mozilla.org/MPL/2.0
#
# http://docs.travis-ci.com/user/customizing-the-build/
# http://lint.travis-ci.org/

#language: cpp

os: linux
dist: xenial
language: generic
services: docker
sudo: false   # http://docs.travis-ci.com/user/workers/container-based-infrastructure/ (required: needed for apt-get)
compiler:
  - gcc
  - clang

cache:
  directories:
    - ~/cache/

matrix:
  fast_finish: true

addons:
  apt:
    sources: # https://github.com/travis-ci/apt-source-whitelist/blob/master/ubuntu.json
      - ubuntu-toolchain-r-test
    packages: [
      # g++ >= 4.8 is required for -std=c++11
      # gcc-5, g++-5,
      ]

env:
  global:
    - DOCIC='timjanik/ci-cache:bionic-180930'

jobs:
    include:

    - stage: Build-Tree
      env: FLOW=clang
      before_install:
        - uname -a && cat /etc/lsb-release && pwd && free -tm && echo nproc=`nproc` && df -h
        - rm -v -rf ~/cache/*
        - touch ~/cache/Build-Tree-$FLOW && ls -l ~/cache/
        - cd ~ && git clone --branch=master https://github.com/tim-janik/beast.git && cd beast
      script:
        - pwd
        - echo './autogen.sh --prefix=/usr CC=clang CXX=clang++' >TEST
      before_cache:
        - cd ~/cache/ && mv -v ~/beast/ .

    - stage: Check-Build
      env: FLOW=clang
      before_install:
        - touch ~/cache/Check-Build-$FLOW && ls -l ~/cache/
        - mv -v ~/cache/beast/ ~ && cd ~/beast/
      script:
        - pwd
        - egrep clang TEST

    - stage: Deploy
      env: FLOW=barzonk
      install:
        - touch ~/cache/Deploy-$FLOW && ls -l ~/cache/
      script:
        - echo Deploy and upload...
        - ls -l ~/cache/

notifications:
  irc: false
  email: false
